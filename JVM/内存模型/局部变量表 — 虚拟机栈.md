# 局部变量表 — 虚拟机栈

概念：

* 通过数字数组实现，存储方法参数和定义在方法体内的局部变量（包括基本数据类型，对象引用和returnAddress类型）
* 为线程私有，不存在线程安全问题
* 局部变量表的容量在编译期就确定下来。
* 栈的大小决定了方法嵌套的调用次数
* 局部变量表中的变量只在当前方法调用中有效，在方法执行的过程中，通过使用局部变量表来实现参数值到参数变量列表的传递过程，并随着栈帧的销毁而销毁。



代码示例：

```java
public class LocalVariablesTable {

    public static void main(String[] args) {
        LocalVariablesTable table = new LocalVariablesTable();
        int a = 1;
    }
}
```

![image-局部变量表](局部变量表.png)

![image-字节码解读局部变量表](字节码解读局部变量表.png)



## slot变量槽

### slot定义

* 局部变量表的基本单位 -- slot
* 存放各种基本数据类型，引用类型（reference），returnAddress类型的变量
* 32位以内的类型占用一个slot（包括returnAddress类型），64位的类型（long/double）占用2个slot

boolean=1个比特

byte=1个字节

int=4个字节

char=2个字节

short=2个字节

float=4个字节

double=8个字节

long=8个字节

![image-slot变量槽](slot变量槽.png)



### slot工作方法

* 给每个slot分配一个访问索引，通过索引来访问到局部变量表中指定的变量值
* 当调用方法的时候，方法参数和方法体内的局部变量会按照声明顺序被复制到局部变量表中的每个slot上
* 如果访问2个slot的变量值时，只需要使用前一个slot的索引即可
* 如果当前方法为实例方法或构造方法，则该对象引用this将会存放在index为0的slot，其他参数按照参数列表顺序排列
* 静态方法无法调用this，是由于该方法的局部变量表是不存在this的声明



### slot其他特性--重复利用

当一个局部变量越过了其作用域，那么之后声明的变量将复用之前变量的槽位，最终到达节省资源的目的。

![image-slot重复利用](slot重复利用-1.png)



### 补充说明

* 虚拟机通过局部变量表来完成方法中参数的传递。在栈帧中，与性能调优关系最为密切的部分正是局部变量表。
* 局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收