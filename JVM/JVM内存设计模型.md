# JVM内存设计模型

![image-20201111193103716](C:\Users\oper\AppData\Roaming\Typora\typora-user-images\image-20201111193103716.png)



**程序计数器**

是内存中较小的内存空间，为当前线程所执行的字节码的行号指示器。在字节码解释器工作时，通过改变计数器的值来选取下一条要执行的字节码指令，体现在分支，循环，跳转，异常处理，线程恢复等场景。如果线程执行的是一个Java方法时，计数器记录的是虚拟机字节码指令的地址，如果线程执行的是本地方法时，计数器的值则为空。为线程私有。



**Java虚拟机栈**

也是线程私有，生命周期与线程相同。虚拟机栈描述的是Java方法执行的线程内存模型，在每个方法被执行的时候，Java虚拟机都会同步创建一个栈帧，用于存放局部变量表，操作数栈，动态链接，方法出口等信息。每个方法从被调用到执行完毕的过程，就是一个栈帧在虚拟机栈中从入栈到出栈的过程。

* 局部变量表

  存放了编译期可知的各种Java虚拟机的基本数据类型，对象引用和returnAddress类型（指向一条字节码指令的地址）。这些数据类型在局部变量表中以局部变量槽的形式体现，其中64位长度的long和double类型占用2个slot槽，其余占用1个slot。局部变量表在编译期就完成分配，当进入一个方法时，这个方法需要在栈帧中分配多大的局部变量空间时完全确定的。

**本地方法栈**

与虚拟机栈发挥的作用类似，主要区别在于，虚拟机栈服务于虚拟机执行Java方法，本地方法栈则服务于本地方法。



**Java堆**

虚拟机中所管理的最大一块内存，为所有线程所共享，在虚拟机启动时所创建，唯一的作用是存放对象实例。在物理上是不连续的内存空间，但在逻辑上可被视为连续的。



**方法区**

是各个线程共享的区域，用于存放已被虚拟机加载的类型信息，常量，静态变量，即时编译器后的缓存代码等数据。

* 运行时常量池

  是方法区的一部分。在class文件中有一项信息是常量池表，用于存放编译期生成的各种字面量与符号引用，在被类加载后存放到方法区的运行时常量池中



**直接内存**

不属于虚拟机运行时数据区的一部分。在NIO类，引入了一种基于通道（channel）与缓冲区的IO方式，它可以使用Native函数库直接分配对外内存，然后通过一个存储在Java堆里面的DirectByteBuffer对象作为这块内存的引用来操作。这种方法可以显著提高性能，避免了在JAVA堆和native堆中来回复制数据。